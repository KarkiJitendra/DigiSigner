{% extends "base.html" %}

{% block title %}Dashboard - Digital Signature Management{% endblock %}

{% block meta_description %}
    Manage your digital signatures, sign documents online, and track your signing workflow.
{% endblock %}

{% block meta_keywords %}
    dashboard, digital signature, document management, sign documents, track signatures
{% endblock %}
{%load static%}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <h1>Digital Signature Online Service</h1>
        <p>Sign Documents Online Securely and Efficiently</p>
    </div>

    <!-- Welcome Card -->
    <div class="welcome-card">
        <div class="welcome-content">
            <h2>Welcome back, {% if user.get_full_name %}{{ user.get_full_name }}{% else %}{{ user.username }}{% endif %}! ðŸ‘‹</h2>
            <p>You have <strong>3 free documents</strong> remaining this month. <span class="current-date"></span></p>
        </div>
        <div class="usage-stats">
            <div class="stat-item">
                <span class="stat-number">{{ user_stats.documents|default:"1,247" }}</span>
                <span class="stat-label">Total Documents</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ user_stats.signed|default:"892" }}</span>
                <span class="stat-label">Signed</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ user_stats.pending|default:"128" }}</span>
                <span class="stat-label">Pending</span>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="quick-stats">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-file-contract"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-documents">1,247</h3>
                <p>Total Documents</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-signed">892</h3>
                <p>Signed Documents</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-pending">128</h3>
                <p>Pending Signatures</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-layer-group"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-templates">45</h3>
                <p>Saved Templates</p>
            </div>
        </div>
    </div>

    <!-- Signing Cards Grid -->
    <div class="signing-cards">
        <!-- Sign Document Now Card -->
        <div class="signing-card">
            <div class="signing-card-header">
                <h3>SIGN DOCUMENT NOW</h3>
                <p>100% free & secure unlimited documents</p>
            </div>
            
            <div class="file-formats">
                <span class="format-badge">PDF</span>
                <span class="format-badge">DOC</span>
                <span class="format-badge">XLS</span>
                <span class="format-badge">JPG</span>
            </div>
            
            <div class="upload-area" id="sign-now-upload">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">Drop your file or choose file</div>
                <div class="upload-subtext">PDF | DOC | XLS | JPG</div>
                <input type="file" class="file-input" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png">
            </div>
            
            <div class="uploaded-files">
                <!-- Files will appear here -->
            </div>
            
            <div class="action-buttons">
                <a href="{% url 'upload_document' %}" class="btn-sign" style="text-decoration: none; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-signature" style="margin-right: 8px;"></i> SIGN DOCUMENT NOW
                </a>
            </div>
        </div>

        <!-- Send for Signing Card -->
        <div class="signing-card">
            <div class="signing-card-header">
                <h3>SEND FOR SIGNING</h3>
                <p>Full 14-day trial then 3 free docs per month</p>
            </div>
            
            <div class="file-formats">
                <span class="format-badge">PDF</span>
                <span class="format-badge">DOC</span>
                <span class="format-badge">XLS</span>
                <span class="format-badge">JPG</span>
            </div>
            
            <div class="upload-area" id="send-signing-upload">
                <div class="upload-icon">
                    <i class="fas fa-paper-plane"></i>
                </div>
                <div class="upload-text">Drop your file or choose file</div>
                <div class="upload-subtext">PDF | DOC | XLS | JPG</div>
                <input type="file" class="file-input" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png">
            </div>
            
            <div class="uploaded-files">
                <!-- Files will appear here -->
            </div>
            
            <div class="action-buttons">
                <button class="btn-sign-outline" onclick="handleSendForSigning()">
                    <i class="fas fa-share-square"></i> SEND FOR SIGNING
                </button>
            </div>
        </div>
    </div>

    <!-- Recent Documents -->
    <div class="recent-documents">
        <div class="section-header">
            <h2>Recent Documents</h2>
            <a href="#" class="view-all">View All â†’</a>
        </div>
        
        <div class="table-responsive">
            <table class="documents-table">
                <thead>
                    <tr>
                        <th>Document Name</th>
                        <th>Type</th>
                        <th>Created</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc in documents %}
                    <tr>
                        <td>
                            <div class="document-name">
                                <i class="fas fa-file-pdf document-icon"></i>
                                <span>{{ doc.title }}</span>
                            </div>
                        </td>
                        <td>PDF</td>
                        <td>{{ doc.created_at|timesince }} ago</td>
                        <td>
                            {% if doc.signed_file %}
                                <span class="status-badge" style="background: #e8f5e9; color: #2e7d32; padding: 4px 8px; border-radius: 4px;">Signed</span>
                            {% else %}
                                <span class="status-badge" style="background: #fff3e0; color: #ef6c00; padding: 4px 8px; border-radius: 4px;">Pending</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="action-dropdown" style="display: flex; gap: 10px;">
                                {% if doc.signed_file %}
                                    <a href="{{ doc.signed_file.url }}" target="_blank" title="Download"><i class="fas fa-download"></i></a>
                                {% else %}
                                    <a href="{% url 'sign_document' doc.id %}" title="Sign Now"><i class="fas fa-pen"></i></a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px;">No documents found. Upload one to get started!</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="recent-documents">
        <div class="section-header">
            <h2>Quick Links</h2>
        </div>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
            <a href="#" class="btn-sign-outline" style="flex-direction: column; padding: 20px; text-align: center;">
                <i class="fas fa-layer-group" style="font-size: 24px; margin-bottom: 10px;"></i>
                <span>Templates</span>
            </a>
            <a href="{% url 'upload_signature' %}" class="btn-sign-outline" style="flex-direction: column; padding: 20px; text-align: center; text-decoration: none;">
                <i class="fas fa-pen-nib" style="font-size: 24px; margin-bottom: 10px;"></i>
                <span>Signature</span>
            </a>
            
            {% if has_keys %}
            <div class="btn-sign-outline" style="flex-direction: column; padding: 20px; text-align: center; background-color: #e8f5e9; border-color: #4CAF50; cursor: default;">
                <i class="fas fa-key" style="font-size: 24px; margin-bottom: 10px; color: #4CAF50;"></i>
                <span style="color: #2e7d32;">Keys Active</span>
            </div>
            {% else %}
            <a href="{% url 'generate_keys' %}" class="btn-sign-outline" style="flex-direction: column; padding: 20px; text-align: center; text-decoration: none;">
                <i class="fas fa-key" style="font-size: 24px; margin-bottom: 10px;"></i>
                <span>Gen Keys</span>
            </a>
            {% endif %}
            <a href="{% url 'verify_document' %}" class="btn-sign-outline" style="flex-direction: column; padding: 20px; text-align: center; text-decoration: none;">
                <i class="fas fa-check-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                <span>Verify</span>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}